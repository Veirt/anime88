<?php require("session_start.php") ?>
<?php require("utils.php") ?>
<?php user_authorization("user") ?>

<!DOCTYPE html>
<html lang="en">

<?php $title = "Anime88 - Profile" ?>
<?php include("includes/head.php") ?>
<?php

$user_id = $_SESSION['user']['id'];

$user_info = getUserInfo($user_id);
$user_anime_rating = getUserAnimeRating($user_id);
?>

<body>
    <?php include("includes/navbar.php") ?>

    <main>
        <section class="profile-main">
            <div class="profile-user">
                <svg class="profile-pic" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="796 796 200 200" enable-background="new 796 796 200 200" xml:space="preserve">
                    <path d="M896,796c-55.14,0-99.999,44.86-99.999,100c0,55.141,44.859,100,99.999,100c55.141,0,99.999-44.859,99.999-100
                    C995.999,840.86,951.141,796,896,796z M896.639,827.425c20.538,0,37.189,19.66,37.189,43.921c0,24.257-16.651,43.924-37.189,43.924
                    s-37.187-19.667-37.187-43.924C859.452,847.085,876.101,827.425,896.639,827.425z M896,983.86
                    c-24.692,0-47.038-10.239-63.016-26.695c-2.266-2.335-2.984-5.775-1.84-8.82c5.47-14.556,15.718-26.762,28.817-34.761
                    c2.828-1.728,6.449-1.393,8.91,0.828c7.706,6.958,17.316,11.114,27.767,11.114c10.249,0,19.69-4.001,27.318-10.719
                    c2.488-2.191,6.128-2.479,8.932-0.711c12.697,8.004,22.618,20.005,27.967,34.253c1.144,3.047,0.425,6.482-1.842,8.817
                    C943.037,973.621,920.691,983.86,896,983.86z" />
                </svg>
                <h1><?php echo $user_info['username']; ?></h1>
                <div class="total-rated">
                    <p>Total Anime Rated : <?= count($user_anime_rating); ?></p>
                    <p>Mean Score : <?= calculateMeanScore($user_anime_rating); ?></p>
                </div>
            </div>

            <div class="rated-container">
                <?php foreach ($user_anime_rating as $idx => $rating) : ?>
                    <div class="rated-card">
                        <div class="rated-poster">
                            <a href="view.php?id=<?= $rating['id'] ?>"><img src="assets\poster\<?= $rating['poster'] ?>" alt=""></a>
                        </div>
                        <div class="rated-content">
                            <div class="rated-number">#<?= $idx + 1 ?> </div>
                            <div class="rated-title">
                                <a href="view.php?id=<?= $rating['id'] ?>">
                                    <h3>
                                        <?= $rating['anime_title'] ?>
                                    </h3>

                                </a>
                            </div>
                            <div style="display: flex; align-items: center;">

                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
                                    <path d="M16.598,20.574c-0.238,0-0.478-0.058-0.699-0.174l-3.666-1.927c-0.146-0.076-0.319-0.076-0.465,0
                L8.102,20.4c-0.51,0.269-1.116,0.224-1.58-0.114c-0.465-0.338-0.694-0.9-0.597-1.467l0.7-4.082c0.028-0.162-0.026-0.328-0.144-0.442
                l-2.966-2.891c-0.412-0.401-0.557-0.991-0.379-1.538c0.178-0.547,0.642-0.938,1.211-1.021L8.446,8.25
                C8.608,8.226,8.75,8.124,8.822,7.976l1.833-3.714C10.91,3.746,11.425,3.426,12,3.426s1.09,0.32,1.345,0.836l1.833,3.714
                c0.073,0.148,0.214,0.25,0.376,0.274l4.098,0.595c0.569,0.083,1.033,0.474,1.211,1.021c0.178,0.547,0.032,1.136-0.379,1.538
                l-2.965,2.891c-0.118,0.115-0.172,0.28-0.144,0.442l0.7,4.082c0.097,0.567-0.131,1.129-0.597,1.467
                C17.215,20.477,16.908,20.574,16.598,20.574z M12.698,17.588l3.666,1.927c0.173,0.091,0.37,0.077,0.526-0.038
                c0.158-0.115,0.232-0.297,0.199-0.489l-0.7-4.082c-0.083-0.487,0.078-0.983,0.432-1.328l2.965-2.89
                c0.14-0.136,0.187-0.328,0.127-0.513c-0.061-0.186-0.211-0.312-0.404-0.341l-4.098-0.595c-0.489-0.071-0.912-0.378-1.13-0.821
                l-1.832-3.713c-0.173-0.349-0.725-0.349-0.897,0L9.719,8.418c-0.218,0.443-0.64,0.75-1.129,0.821L4.491,9.834
                c-0.192,0.028-0.343,0.155-0.404,0.341c-0.06,0.185-0.013,0.376,0.127,0.513l2.965,2.891c0.354,0.344,0.515,0.84,0.431,1.327
                l-0.7,4.082c-0.033,0.192,0.042,0.375,0.199,0.489c0.157,0.115,0.353,0.129,0.527,0.038l3.665-1.927
                C11.739,17.357,12.261,17.357,12.698,17.588L12.698,17.588z" />
                                </svg>
                                <div class="rated-rate"><?= $rating['rating'] ?></div>

                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </section>
    </main>
</body>

</html>
